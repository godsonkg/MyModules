#!name=流媒体解锁检测·Smart 版（修正版）
#!desc=自动检测候选策略/地区组的 Netflix / Disney+ / YouTube Premium 解锁情况；支持一键写入到选择组进行“锁定地区”
#!author=godsonkg
#!category=Streaming
#!icon=play.tv.fill

[Panel]
# 三个面板分别检测 NF / Disney+ / YouTube Premium
NF 解锁检测 = script-name=unlock_probe, update-interval=1800
Disney+ 解锁检测 = script-name=unlock_probe, update-interval=1800, argument=target=disney
YouTube Premium 解锁检测 = script-name=unlock_probe, update-interval=1800, argument=target=yt

[Script]
# 检测脚本（已经放在你的仓库 MyModules/Scripts 下）
# candidates 用“|”分隔；也可以直接填具体节点名（不是组名也行）
unlock_probe = type=generic,timeout=6,script-path=https://raw.githubusercontent.com/godsonkg/MyModules/main/Scripts/unlock_probe.js,argument=candidates=🇺🇸美国候选|🇯🇵日本候选|🇭🇰香港候选&concurrency=2&target=nf&timeout=6,script-update-interval=86400

[Proxy Group]
# —— 安全兜底：如果 smart 没匹配到任何节点，就不要走 DIRECT，直接拒绝，避免“直连”误判为不可用 ——
🚫无匹配 = reject

# —— 候选地区组：用 Smart 从机场订阅里自动筛选节点（按你的节点命名习惯可自行调整正则） ——
🇺🇸美国候选 = smart, \
 policy-regex-filter=(?i)(\bUS\b|USA|United.?States|America|美.?国|洛杉矶|圣何塞|芝加哥|达拉斯|硅谷|西雅图|LAX|SJC), \
 interval=600, tolerance=100, timeout=5, final-policy=🚫无匹配

🇯🇵日本候选 = smart, \
 policy-regex-filter=(?i)(\bJP\b|Japan|日本|东京|大阪|千叶|埼玉|Tokyo|Osaka|TYO|KIX), \
 interval=600, tolerance=100, timeout=5, final-policy=🚫无匹配

🇭🇰香港候选 = smart, \
 policy-regex-filter=(?i)(\bHK\b|Hong.?Kong|香港|铜锣湾|中环|沙田|将军澳|HKG), \
 interval=600, tolerance=100, timeout=5, final-policy=🚫无匹配

# —— 选择组（关键）：供规则引用 & 脚本一键写入 —— 
# 先把三个候选组都列进来，另外留 DIRECT 方便手动切
NF-选择 = select, 🇺🇸美国候选, 🇯🇵日本候选, 🇭🇰香港候选, DIRECT
DISNEY-选择 = select, 🇺🇸美国候选, 🇯🇵日本候选, 🇭🇰香港候选, DIRECT
YT-选择 = select, 🇺🇸美国候选, 🇯🇵日本候选, 🇭🇰香港候选, DIRECT

[Rule]
# Netflix
DOMAIN-SUFFIX,netflix.com,NF-选择
DOMAIN-SUFFIX,nflxvideo.net,NF-选择
DOMAIN-SUFFIX,nflximg.net,NF-选择
DOMAIN-SUFFIX,nflxso.net,NF-选择
# Disney+
DOMAIN-SUFFIX,disneyplus.com,DISNEY-选择
DOMAIN-SUFFIX,bamgrid.com,DISNEY-选择
# YouTube
DOMAIN-SUFFIX,youtube.com,YT-选择
DOMAIN-SUFFIX,googlevideo.com,YT-选择
